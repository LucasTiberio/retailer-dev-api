pool:
  vmImage: 'Ubuntu 16.04'

trigger:
  branches:
      include:
      - staging

resources:
  containers:
  - container: pg11
    image: postgres:11

jobs:
- job: Tests
  pool:
    vmImage: 'ubuntu-16.04'
  services: 
    postgres: pg11
  steps:

    - script: |
        apt install -y postgresql-client
        psql --host=postgres --username=postgres --command="SELECT 1;"

    - task: NodeTool@0
      inputs:
        versionSpec: '12.x'
      displayName: 'Use Node.js 12'

    - script: |
        npm install
        npm run test
      env: 
        DB_TEST_USER: postgres
        DB_TEST_PASSWORD: postgres
        DB_TEST_DATABASE: postgres
        DB_TEST_HOST: localhost
        DB_TEST_PORT: 5432
